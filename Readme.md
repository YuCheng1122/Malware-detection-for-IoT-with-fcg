# Detector Project

## Project Overview
This project implements a machine learning-based system for detecting and classifying files as benign or malware. It utilizes a Graph Convolutional Network (GCN) with attention mechanisms to process and analyze graph-structured data extracted from files.

## Project Structure
```
detector/
├── config.json
├── config.py
├── const.py
├── gcn_detector.py
├── main.py
├── models/
│   ├── __init__.py
│   ├── gcn_attention.py
│   ├── predict.py
│   └── train_gcn.py
├── requirements.txt
└── utils/
    ├── __init__.py
    ├── graph_preprocessing.py
    ├── normalize_assembly.py
    ├── tools.py
    └── word2vec_cbow.py
```

## Setup Instructions

### Prerequisites
- Python 3.10+
- Virtual environment (recommended)
- CUDA-compatible GPU (for faster training and prediction)

### Installation
1. Clone the repository:
   ```bash
   git clone <repository-url>
   cd detector
   ```

2. Set up a virtual environment:
   ```bash
   python3 -m venv venv
   source venv/bin/activate  # On Windows: venv\Scripts\activate
   ```

3. Install dependencies:
   ```bash
   pip install -r requirements.txt
   ```

### Configuration
Edit `config.json` to set up paths, model parameters, and other configuration options as needed.

## Usage

### Data Preparation
1. Place your training data in the directory specified by `DEFAULT_INPUT_PATH` in `config.json`.
2. Place your prediction data in the directory specified by `PREDICT_DIR` in `config.json`.
3. Ensure your data is in the correct format (JSON files representing graphs).

### Running the Project
The project is controlled through the `main.py` script. To run the entire pipeline:

```bash
python main.py
```

This script will:
1. Load the configuration from `config.json`
2. Set up logging
3. Initialize the `SubDetector`
4. Run the prediction process

To run specific parts of the pipeline, uncomment the relevant sections in `main.py`:

- For assembly normalization:
  ```python
  detector.normalize_assembly_files()
  detector.normalize_prediction_files()
  ```

- For Word2Vec training:
  ```python
  detector.train_word2vec()
  ```

- For graph processing:
  ```python
  detector.process_graphs()
  ```

- For GCN training:
  ```python
  detector.train_gcn()
  ```

- For prediction (currently active):
  ```python
  detector.predict()
  ```

## Components

- `gcn_detector.py`: Contains the `SubDetector` class, which orchestrates the entire detection process.
- `models/gcn_attention.py`: Implements the GCN with attention mechanism.
- `models/predict.py`: Handles the prediction logic.
- `utils/graph_preprocessing.py`: Preprocesses graph data.
- `utils/normalize_assembly.py`: Normalizes assembly code.
- `utils/word2vec_cbow.py`: Implements Word2Vec training.

## Logging
The project uses a comprehensive logging system. Logs are stored in subdirectories under the `LOGS_PATH` specified in `config.json`, including:
- GCN logs
- Word2Vec logs
- Graph processing logs
- Assembly normalization logs

## References
Wu, X.W., Wang, Y., Fang, Y. et al. Embedding vector generation based on function call graph for effective malware detection and classification. Neural Comput & Applic 34, 8643–8656 (2022). https://doi.org/10.1007/s00521-021-06808-8

## License
This project is licensed under the MIT License. See the LICENSE file for details.
